void Mediator::join_cmd(Client *client){
    if (client->__cmd.size() < 2){
        client->put_message(":ft_irc 461 " + client->get_nickname() +" :Not enough parameters");
        return;
    }
    std::vector<std::string> channels = std::vector<std::string>();
    std::vector<std::string> keys = std::vector<std::string>();
    if (client->__cmd.size() >= 2)
        channels = split(client->__cmd[1], ',');
    if (client->__cmd.size() >= 3) {
        keys = split(client->__cmd[2], ',');
    }
    std::vector<std::string>::iterator it = channels.begin();
    int j = 0;
    for (; it != channels.end(); ++it, ++j){
        if (it->c_str()[0] != '#')
        {
            client->put_message(":ft_irc 476 " + client->get_nickname() +" :Bad Channel Mask");
            return ;
        }
		else 
		{
            if(it->size() == 1){
                client->put_message(":ft_irc 480 " + client->get_nickname() +" :you need name of channel");
                return ;
            }
        }
        // if (this->__channels.find(*it) == this->__channels.end())
		//  {
        //     Channel *channel = NULL;
        //     if (!keys.empty() && j < (int)keys.size()) {
        //         channel = new Channel(*it, "", keys[j]);
        //         channel->set_key(keys[j]);
        //     } 
		// 	else
        //         channel = new Channel(*it, "", "");
        //     channel->set_modeinvite(false);
        //     channel->set_modetopic(false);
        //     channel->add_moderator(client->get_socket());
        //     channel->add_client(client);
        //     client->subscribe_to_channel(channel);
        //     this->__channels.insert(std::make_pair(*it, channel));
        //     notify_clients_of_new_member(channel, client);
        //     // client->put_message(":" + client->get_nickname() + " JOIN " + channel->get_name());
        // } 
		else {
            Channel *channel = this->__channels.at(*it);
            if (channel && channel->get_all_client().size() == 0) { // yaakoub add this lines
                channel->add_moderator(client->get_socket());
            }
            if (channel && channel->find_client(client->get_socket())) {
                client->put_message(":ft_irc 480 " + client->get_nickname() +" :is already on channel");
                return ;
            }
            if (channel && channel->get_modeinvite())
			 {
                if (channel->is_invited(client->get_socket())) 
				{
                    if (!keys.empty() && j < (int)keys.size()) 
					{
                        if (keys[j] == channel->get_key()) 
						{
                                channel->add_client(client);
                                client->subscribe_to_channel(channel);
                                notify_clients_of_new_member(channel, client);
                                // client->put_message(":" + client->get_nickname() + "!" + client->get_username() + "@" + client->get_hostname() + " JOIN " + channel->get_name());
                        } 
						else 
						{
                            client->put_message(":ft_irc 475 " + client->get_nickname() + " " + channel->get_name() + " :Cannot join channel (+k)");
                        }
                    }
                }
				 else 
				{
                    client->put_message(":ft_irc 473 " + client->get_nickname() + " " + channel->get_name() + " :Cannot join channel (+i)");
                }
            } 
			// else 
			// {
            //         if (!channel->get_key().empty()) {
            //             if (!keys.empty() && j < (int)keys.size() && keys[j] == channel->get_key()) {
            //                     channel->add_client(client);
            //                     client->subscribe_to_channel(channel);
            //                     notify_clients_of_new_member(channel, client);
            //                     // client->put_message(":" + client->get_nickname() + " JOIN " + channel->get_name());
            //             } else {
            //                 client->put_message(":ft_irc 475 " + client->get_nickname() + " " + channel->get_name() + " :Cannot join channel (+k)");
            //             }
            //             } else {
            //                 channel->add_client(client);
            //                 client->subscribe_to_channel(channel);
            //                 notify_clients_of_new_member(channel, client);
            //                 // client->put_message(":" + client->get_nickname() + "!" + client->get_username() + "@" + client->get_hostname() + " JOIN " + channel->get_name());
            //     }
            }
        }
    }
}